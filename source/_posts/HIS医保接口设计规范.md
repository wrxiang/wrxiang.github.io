---
title: HIS医保接口设计规范
categories : 程序员日常思考
tag : [HIS, 医保]
date: 2019-09-09 22:30:03
---
## 背景
医保接口的开发可以说是HIS系统中极其重要的一部分，从某种意义上讲，医保接口实施的好坏直接影响项目总体的进度和效果，但是由于医保政策的复杂性，再加上医保往往有很大的地区差异，在项目交付的过程中，软件设计及开发人员遇到许多比较复杂或者难以解决的问题。
结合之前项目中医保实施的经验，并对医保接口设计过程中的方法进行归纳，给出一种比较完善的设计解决方法和规范，可以帮助研发或实施人员更好的实施医保，目前只是一个粗糙的框架，还需要医保实践不断的进行扩充，以至形成一种比较稳定完善的综合性解决方案。
## 医疗政策软件
通过对北京安宁盈科、创智、东软、杭州新世纪、建达电子、万达信息等各个医保政策软件提供商提供的接口方案进行分析，总结出他们之间的异同性如下：
1. 一般都提供DOS和Windows两套方案，Windows下一般以WIN32 API的形式进行调用（dll提供了政策函数），这里我们以Windows为重点进行说明。
2. 政策函数一般分为两类：单个函数和多个函数两种设计类型。多个函数是指每种业务或者比较相似的业务为一个函数，这样组成登记、结算、退费等，如杭州新世纪；单个函数是指所有业务都用一个函数实现，参数一般使用结构字符串实现，如上海万达公司。
3. 结算时费用明细数据分为实时上传和非实时上传，实时上传要求结算时就将费用明细上传至医保中心，比如东软公司接口，非实时上传则是为了减少网络阻塞，结算时只上传大类费用或总费用，费用明细可隔天上传，比如上海万达公司。
4. 住院或门诊发生费用时，药品/项目的自负比例一般分为三种类别，第一种自负比例按照HIS中设置的计算，并且也不用审批；第二种HIS中需要根据医保中心下发的药品/项目字典维护对照表，按照对照表中的自负比例计算，并且需要审批；第三种HIS计算费用时不管自负比例，只需对照好编码，在上传费用时医保中心会返回每条费用的自负比例。
5. 结算前一般都需要刷卡，有些地区的医保允许只在挂号或登记时刷卡，结算时可以不刷卡，只要能将个人信息从HIS中取出即可。
6. 结算分为预结算及结算两部分，预结算阶段处理数据的上传或调用医保的结算计算函数获取医保支付信息，结算阶段执行结算处理，和医保政策软件进行结算交易。一般预结算和结算医保政策软件返回的医保支付信息是一致的，但是在医保实施的过程中确实也发现有少数的医保在某些情况下预结算和结算结果不同，一旦出现这种情况，是需要HIS进行相应的处理的。

## 医保病人就诊流程
医保病人就诊的一般流程是：登记 → 发生费用 → 结算，此外还有结算作废、退款补结算等操作
* 登记：登记一般需要验证身份，一些医保可能还需要输入一些病人的入院信息。
* 发生费用：有些医保需要对药品/项目进行审批，有些则要按照统一的目录取值，这就要求HIS的药品/项目和医保之间有一个对照。
* 结算：验证身份 → 预结算计算费用信息并获取医保支付信息 → 确认结算发送确认交易请求。
* 结算作废：一般需要验证身份，然后调用医保的结算作废，将操作的医保结算作废掉。
* 退款补结算：这里不是指结算作废，而是只退一部分，某些医保支持部分退的功能，有些不支持，支持的可以直接根据医保政策软件做，不支持的医保可以采取全部退然后再收一部分的步骤来实现。

对医保病人的就诊流程分析，我们可以看到医保政策软件的接口千差万别，但是HIS中关注的操作主要是以下几个：身份验证、登记、预结算、结算、结算作废

## 接口规范设计
通过对医保政策软件以及医保病人就诊结算的流程进行的分析，我们希望能够利用各个医保政策软件的共性，屏蔽其差异，隔离HIS和医保政策软件之间的业务交互，这样对于HIS来说，调用方式和接口是相同的，有利于医保的批量实施以及迎合各地医保业务的多变性，减少HIS程序频繁的修改和后期运维工作，所以医保接口设计规范总的原则如下：
1. HIS端业务和医保政策软件隔离，HIS窗口业务中不要加入医保的处理过程，但是可以加入对象方法的调用，不同的医保封装为不同的对象，对外暴漏统一的方法，根据不同的医保调用不同医保对象中的方法，这样的话上线医保仅需增加医保对象即可。
2. 利用共性，屏蔽个性，将HIS中调用医保的位置，事件名称及具体业务明确化，规范化，尽量减少HIS中调用医保接口的地方，或者在一个函数事件中集中处理，利于维护。
3. 函数返回值单一化，只有成功或失败两种情况，其他的返回信息可放在JSON中返回。






